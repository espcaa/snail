name: macos app build

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-14

    steps:
      - name: ‚¨áÔ∏è Checkout Code
        uses: actions/checkout@v4

      - name: üõ†Ô∏è Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: "1.22"

      - name: Install Fyne
        run: go install fyne.io/tools/cmd/fyne@latest

      # --- Build macOS ARM64 ---
      - name: ‚öôÔ∏è Build macOS (ARM64)
        working-directory: ./app
        run: |
          env GOOS=darwin GOARCH=arm64 go build -o ../build/arm64/snail-installer
          env GOOS=darwin GOARCH=arm64 fyne package -os darwin \
            --exe ../build/arm64/snail-installer \
            --icon ../app/Icon.png \
            --id eu.espcaa.snailinstaller

      - name: ‚¨ÜÔ∏è Upload macOS ARM64 Artifact
        uses: actions/upload-artifact@v4
        with:
          name: macos-arm64-app
          path: app/*.app

      # --- Build macOS Intel (AMD64) ---
      - name: ‚öôÔ∏è Build macOS (AMD64)
        working-directory: ./app
        run: |
          env GOOS=darwin GOARCH=amd64 go build -o ../build/arm64/snail-installer
          env GOOS=darwin GOARCH=amd64 fyne package -os darwin \
            --exe ../build/arm64/snail-installer \
            --icon ../app/Icon.png \
            --id eu.espcaa.snailinstaller

      - name: ‚¨ÜÔ∏è Upload macOS AMD64 Artifact
        uses: actions/upload-artifact@v4
        with:
          name: macos-amd64-app
          path: ./*.app
