var v=require("electron"),z={},H=(k,m)=>{let q=document.createElement("style");q.setAttribute("data-slackmod",m),q.textContent=k,document.head.appendChild(q)},K=async(k,m)=>{let q=new Blob([k],{type:"text/javascript"}),w=URL.createObjectURL(q);try{return(await import(w)).default}finally{URL.revokeObjectURL(w)}},A=()=>v.ipcRenderer.sendSync("SNAIL_GET_PLUGIN_LIST"),E=(k)=>v.ipcRenderer.sendSync("SNAIL_GET_PLUGIN_FILE",k),G=async(k)=>{let m=E(k.id);if(!m)return!1;if(m.css)H(m.css,`plugin-${k.id}-style`);if(m.code)try{let q=await K(m.code,`plugin-${k.id}`);if(!q)return!1;let w=new q;if(z[k.id]=w,typeof w.start==="function")w.start();return console.log(`[snail] Started plugin: ${k.id}`),!0}catch(q){return console.error(`[snail] Failed to start plugin ${k.id}:`,q),!1}return!0},N=(k)=>{let m=z[k];if(m&&typeof m.stop==="function")try{m.stop(),console.log(`[snail] Stopped plugin: ${k}`)}catch(q){console.error(`[snail] Error stopping plugin ${k}:`,q)}delete z[k],document.querySelectorAll(`script[data-slackmod="plugin-${k}"]`).forEach((q)=>q.remove()),document.querySelectorAll(`style[data-slackmod="plugin-${k}-style"]`).forEach((q)=>q.remove())};v.contextBridge.exposeInMainWorld("snail",{getPluginList:A,getPluginFile:E,enablePlugin:async(k)=>{let m=v.ipcRenderer.sendSync("SNAIL_ENABLE_PLUGIN",k);if(m)await G({id:k,enabled:!0});return m},disablePlugin:(k)=>{return N(k),v.ipcRenderer.sendSync("SNAIL_DISABLE_PLUGIN",k)}});window.addEventListener("DOMContentLoaded",async()=>{let k=A();console.log(`[snail] Found ${k.length} plugins.`),console.log(`[snail] ${k.filter((m)=>m.enabled).length} enabled plugins.`);for(let m of k)console.log(`[snail] Plugin: ${m.id}, Enabled: ${m.enabled}`);for(let m of k)if(m.enabled){let q=await G(m);console.log(q?`[snail] Loaded plugin: ${m.id}`:`[snail] Failed to load plugin: ${m.id}`)}});
