import{createRequire as y}from"node:module";var N=Object.create;var{getPrototypeOf:R,defineProperty:x,getOwnPropertyNames:V}=Object;var j=Object.prototype.hasOwnProperty;var S=(r,E,_)=>{_=r!=null?N(R(r)):{};let t=E||!r||!r.__esModule?x(_,"default",{value:r,enumerable:!0}):_;for(let h of V(r))if(!j.call(t,h))x(t,h,{get:()=>r[h],enumerable:!0});return t};var k=(r,E)=>()=>(E||r((E={exports:{}}).exports,E),E.exports);var D=y(import.meta.url);var v=k((W,q)=>{var __dirname="/Users/alice/projects/snail/core/node_modules/electron",O=D("fs"),T=D("path"),f=T.join(__dirname,"path.txt");function z(){let r;if(O.existsSync(f))r=O.readFileSync(f,"utf-8");if(process.env.ELECTRON_OVERRIDE_DIST_PATH)return T.join(process.env.ELECTRON_OVERRIDE_DIST_PATH,r||"electron");if(r)return T.join(__dirname,"dist",r);else throw Error("Electron failed to install correctly, please delete node_modules/electron and try installing again")}q.exports=z()});var o=S(v(),1),m={},F=(r,E)=>{let _=document.createElement("style");_.setAttribute("data-slackmod",E),_.textContent=r,document.head.appendChild(_)},G=async(r,E)=>{let _=new Blob([r],{type:"text/javascript"}),t=URL.createObjectURL(_);try{return(await import(t)).default}finally{URL.revokeObjectURL(t)}},w=()=>o.ipcRenderer.sendSync("SNAIL_GET_PLUGIN_LIST"),A=(r)=>o.ipcRenderer.sendSync("SNAIL_GET_PLUGIN_FILE",r),H=async(r)=>{let E=A(r.id);if(!E)return!1;if(E.css)F(E.css,`plugin-${r.id}-style`);if(E.code)try{let _=await G(E.code,`plugin-${r.id}`);if(!_)return!1;let t=new _;if(m[r.id]=t,typeof t.start==="function")t.start();return console.log(`[SlackMod] Started plugin: ${r.id}`),!0}catch(_){return console.error(`[SlackMod] Failed to start plugin ${r.id}:`,_),!1}return!0},K=(r)=>{let E=m[r];if(E&&typeof E.stop==="function")try{E.stop(),console.log(`[SlackMod] Stopped plugin: ${r}`)}catch(_){console.error(`[SlackMod] Error stopping plugin ${r}:`,_)}delete m[r],document.querySelectorAll(`script[data-slackmod="plugin-${r}"]`).forEach((_)=>_.remove()),document.querySelectorAll(`style[data-slackmod="plugin-${r}-style"]`).forEach((_)=>_.remove())};o.contextBridge.exposeInMainWorld("slackmod_custom",{getPluginList:w,getPluginFile:A,enablePlugin:async(r)=>{let E=o.ipcRenderer.sendSync("SNAIL_ENABLE_PLUGIN",r);if(E)await H({id:r,enabled:!0});return E},disablePlugin:(r)=>{return K(r),o.ipcRenderer.sendSync("SNAIL_DISABLE_PLUGIN",r)}});window.addEventListener("DOMContentLoaded",async()=>{let r=w();console.log(`[SlackMod] Found ${r.length} plugins.`);for(let E of r)if(E.enabled){let _=await H(E);console.log(_?`[SlackMod] Loaded plugin: ${E.id}`:`[SlackMod] Failed to load plugin: ${E.id}`)}});
