import{createRequire as N}from"node:module";var c=Object.create;var{getPrototypeOf:h,defineProperty:Q,getOwnPropertyNames:w}=Object;var U=Object.prototype.hasOwnProperty;var A=(o,T,x)=>{x=o!=null?c(h(o)):{};let q=T||!o||!o.__esModule?Q(x,"default",{value:o,enumerable:!0}):x;for(let v of w(o))if(!U.call(q,v))Q(q,v,{get:()=>o[v],enumerable:!0});return q};var B=(o,T)=>()=>(T||o((T={exports:{}}).exports,T),T.exports);var W=N(import.meta.url);var $=B((G,Z)=>{var __dirname="/Users/alice/projects/snail/core/node_modules/electron",X=W("fs"),k=W("path"),Y=k.join(__dirname,"path.txt");function R(){let o;if(X.existsSync(Y))o=X.readFileSync(Y,"utf-8");if(process.env.ELECTRON_OVERRIDE_DIST_PATH)return k.join(process.env.ELECTRON_OVERRIDE_DIST_PATH,o||"electron");if(o)return k.join(__dirname,"dist",o);else throw Error("Electron failed to install correctly, please delete node_modules/electron and try installing again")}Z.exports=R()});var V=A($(),1);import*as t from"os";import*as y from"path";import*as j from"fs";var b=y.join(t.homedir(),".snail"),H=y.join(b,"plugins"),z=y.join(b,"config.json"),L=y.join(b,"themes"),r=y.join(b,"internal","preload.js"),J=()=>{try{if(j.existsSync(z))return JSON.parse(j.readFileSync(z,"utf8"))}catch(o){console.error("[SNAIL] Failed to read config:",o)}return{serverUrl:"",pluginsEnabled:[],themesEnabled:[]}},O=(o)=>{j.mkdirSync(b,{recursive:!0}),j.writeFileSync(z,JSON.stringify(o,null,2))},S=()=>{if(!j.existsSync(H))return[];return j.readdirSync(H,{withFileTypes:!0}).filter((o)=>o.isDirectory()).map((o)=>o.name)},_=(o)=>{let T=y.join(H,o,"manifest.json");if(!j.existsSync(T))return null;try{return JSON.parse(j.readFileSync(T,"utf8"))}catch(x){return console.error(`[SNAIL] Failed to read manifest for ${o}:`,x),null}},F=(o)=>{let T=y.join(H,o),x={},q=_(o);if(!q)return x;if(q.entry){let v=y.join(T,q.entry);if(j.existsSync(v))x.code=j.readFileSync(v,"utf8")}if(q.css){let v=Array.isArray(q.css)?q.css:[q.css];x.css=v.map((E)=>{let K=y.join(T,E);if(j.existsSync(K))return j.readFileSync(K,"utf8");return""}).join(`
`)}return x};V.ipcMain.on("SNAIL_GET_PLUGINS",(o)=>{try{let T=S(),x=J(),q=T.map((v)=>{let E=_(v);if(!E)return null;return{id:v,manifest:E,enabled:x.pluginsEnabled.includes(v)}}).filter(Boolean);o.returnValue=q}catch(T){console.error("[SNAIL] Error getting plugins:",T),o.returnValue=[]}});V.ipcMain.on("SNAIL_ENABLE_PLUGIN",(o,T)=>{let x=J();if(!x.pluginsEnabled.includes(T))x.pluginsEnabled.push(T),O(x),console.log(`[SNAIL] Enabled plugin: ${T}`);o.returnValue=!0});V.ipcMain.on("SNAIL_DISABLE_PLUGIN",(o,T)=>{let x=J();x.pluginsEnabled=x.pluginsEnabled.filter((q)=>q!==T),O(x),console.log(`[SNAIL] Disabled plugin: ${T}`),o.returnValue=!0});V.ipcMain.on("SNAIL_GET_PLUGIN_FILE",(o,T)=>{let x=F(T);o.returnValue=x});V.app.once("browser-window-created",(o,T)=>{let x=T.webContents.session.getPreloads()||[];if(!x.includes(r))T.webContents.session.setPreloads([...x,r])});
