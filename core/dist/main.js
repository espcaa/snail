var M=Object.create;var{getPrototypeOf:o,defineProperty:T,getOwnPropertyNames:H,getOwnPropertyDescriptor:A}=Object,y=Object.prototype.hasOwnProperty;var W=(b,j,k)=>{k=b!=null?M(o(b)):{};let q=j||!b||!b.__esModule?T(k,"default",{value:b,enumerable:!0}):k;for(let x of H(b))if(!y.call(q,x))T(q,x,{get:()=>b[x],enumerable:!0});return q},$=new WeakMap,G=(b)=>{var j=$.get(b),k;if(j)return j;if(j=T({},"__esModule",{value:!0}),b&&typeof b==="object"||typeof b==="function")H(b).map((q)=>!y.call(j,q)&&T(j,q,{get:()=>b[q],enumerable:!(k=A(b,q))||k.enumerable}));return $.set(b,j),j};var h={};module.exports=G(h);var B=W(require("os")),z=W(require("path")),v=W(require("fs")),J=require("electron"),K=z.join(B.homedir(),".snail"),V=z.join(K,"plugins"),X=z.join(K,"config.json"),L=z.join(K,"themes"),U=z.join(K,"internal","preload.js"),Y=()=>{try{if(v.existsSync(X))return JSON.parse(v.readFileSync(X,"utf8"))}catch(b){console.error("[snail] Failed to read config:",b)}return{serverUrl:"",pluginsEnabled:[],themesEnabled:[]}},O=(b)=>{v.mkdirSync(K,{recursive:!0}),v.writeFileSync(X,JSON.stringify(b,null,2))},N=()=>{if(!v.existsSync(V))return[];return v.readdirSync(V,{withFileTypes:!0}).filter((b)=>b.isDirectory()).map((b)=>b.name)},w=(b)=>{let j=z.join(V,b,"manifest.json");if(!v.existsSync(j))return null;try{return JSON.parse(v.readFileSync(j,"utf8"))}catch(k){return console.error(`[snail] Failed to read manifest for ${b}:`,k),null}},F=(b)=>{let j=z.join(V,b),k={},q=w(b);if(!q)return k;if(q.entry){let x=z.join(j,q.entry);if(v.existsSync(x))k.code=v.readFileSync(x,"utf8")}if(q.css){let x=Array.isArray(q.css)?q.css:[q.css];k.css=x.map((Q)=>{let Z=z.join(j,Q);if(v.existsSync(Z))return v.readFileSync(Z,"utf8");return""}).join(`
`)}return k};J.ipcMain.on("SNAIL_GET_PLUGIN_LIST",(b)=>{try{let j=N(),k=Y(),q=j.map((x)=>{let Q=w(x);if(!Q)return null;return{id:x,manifest:Q,enabled:k.pluginsEnabled.includes(x)}}).filter(Boolean);b.returnValue=q}catch(j){console.error("[snail] Error getting plugins:",j),b.returnValue=[]}});J.ipcMain.on("SNAIL_ENABLE_PLUGIN",(b,j)=>{let k=Y();if(!k.pluginsEnabled.includes(j))k.pluginsEnabled.push(j),O(k),console.log(`[snail] Enabled plugin: ${j}`);b.returnValue=!0});J.ipcMain.on("SNAIL_DISABLE_PLUGIN",(b,j)=>{let k=Y();k.pluginsEnabled=k.pluginsEnabled.filter((q)=>q!==j),O(k),console.log(`[snail] Disabled plugin: ${j}`),b.returnValue=!0});J.ipcMain.on("SNAIL_GET_PLUGIN_FILE",(b,j)=>{let k=F(j);b.returnValue=k});J.app.once("browser-window-created",(b,j)=>{let k=j.webContents.session.getPreloads()||[];if(!k.includes(U))j.webContents.session.setPreloads([...k,U])});
