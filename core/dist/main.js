var F=Object.create;var{getPrototypeOf:L,defineProperty:X,getOwnPropertyNames:O,getOwnPropertyDescriptor:o}=Object,A=Object.prototype.hasOwnProperty;var y=(b,j,k)=>{k=b!=null?F(L(b)):{};let q=j||!b||!b.__esModule?X(k,"default",{value:b,enumerable:!0}):k;for(let v of O(b))if(!A.call(q,v))X(q,v,{get:()=>b[v],enumerable:!0});return q},H=new WeakMap,C=(b)=>{var j=H.get(b),k;if(j)return j;if(j=X({},"__esModule",{value:!0}),b&&typeof b==="object"||typeof b==="function")O(b).map((q)=>!A.call(j,q)&&X(j,q,{get:()=>b[q],enumerable:!(k=o(b,q))||k.enumerable}));return H.set(b,j),j};var _={};module.exports=C(_);var N=y(require("os")),J=y(require("path")),x=y(require("fs")),K=require("electron"),V=J.join(N.homedir(),".snail"),Y=J.join(V,"plugins"),U=J.join(V,"config.json"),Z=J.join(V,"themes"),G=J.join(V,"internal","preload.js"),Q=()=>{try{if(x.existsSync(U))return JSON.parse(x.readFileSync(U,"utf8"))}catch(b){console.error("[snail] Failed to read config:",b)}return{serverUrl:"",pluginsEnabled:[],themesEnabled:[]}},$=(b)=>{x.mkdirSync(V,{recursive:!0}),x.writeFileSync(U,JSON.stringify(b,null,2))},R=()=>{if(!x.existsSync(Y))return[];return x.readdirSync(Y,{withFileTypes:!0}).filter((b)=>b.isDirectory()).map((b)=>b.name)},S=()=>{if(!x.existsSync(Z))return[];return x.readdirSync(Z,{withFileTypes:!0}).filter((b)=>b.isDirectory()).map((b)=>b.name)},T=(b)=>{let j=J.join(Y,b,"manifest.json");if(!x.existsSync(j))return null;try{return JSON.parse(x.readFileSync(j,"utf8"))}catch(k){return console.error(`[snail] Failed to read manifest for ${b}:`,k),null}},w=(b)=>{let j=J.join(Z,b,"manifest.json");if(!x.existsSync(j))return null;try{return JSON.parse(x.readFileSync(j,"utf8"))}catch(k){return console.error(`[snail] Failed to read manifest for theme ${b}:`,k),null}},M=(b)=>{let j=J.join(Y,b),k={},q=T(b);if(!q)return k;if(q.entry){let v=J.join(j,q.entry);if(x.existsSync(v))k.code=x.readFileSync(v,"utf8")}if(q.css){let v=Array.isArray(q.css)?q.css:[q.css];k.css=v.map((z)=>{let W=J.join(j,z);if(x.existsSync(W))return x.readFileSync(W,"utf8");return""}).join(`
`)}return k};K.ipcMain.on("SNAIL_GET_PLUGIN_LIST",(b)=>{try{let j=R(),k=Q(),q=j.map((v)=>{let z=T(v);if(!z)return null;return{id:v,manifest:z,enabled:k.pluginsEnabled.includes(v),name:z.name||v,description:z.description||"",version:z.version||"1.0.0"}}).filter(Boolean);b.returnValue=q}catch(j){console.error("[snail] Error getting plugins:",j),b.returnValue=[]}});K.ipcMain.on("SNAIL_ENABLE_PLUGIN",(b,j)=>{let k=Q();if(!k.pluginsEnabled.includes(j))k.pluginsEnabled.push(j),$(k),console.log(`[snail] Enabled plugin: ${j}`);b.returnValue=!0});K.ipcMain.on("SNAIL_DISABLE_PLUGIN",(b,j)=>{let k=Q();k.pluginsEnabled=k.pluginsEnabled.filter((q)=>q!==j),$(k),console.log(`[snail] Disabled plugin: ${j}`),b.returnValue=!0});K.ipcMain.on("SNAIL_ENABLE_THEME",(b,j)=>{console.log(`[snail] Enabling theme: ${j}`);let k=Q();if(!k.themesEnabled.includes(j))k.themesEnabled.push(j),$(k),console.log(`[snail] Enabled theme: ${j}`);b.returnValue=!0,console.log(`[snail] Theme enabled: ${j}`)});K.ipcMain.on("SNAIL_DISABLE_THEME",(b,j)=>{let k=Q();k.themesEnabled=k.themesEnabled.filter((q)=>q!==j),$(k),console.log(`[snail] Disabled theme: ${j}`),b.returnValue=!0});K.ipcMain.on("SNAIL_GET_THEME_LIST",(b)=>{try{let j=S(),k=Q(),q=j.map((v)=>{let z=w(v);if(!z)return null;return{id:v,manifest:z,enabled:k.themesEnabled.includes(v),name:z.name||v,description:z.description||"",version:z.version||"1.0.0"}}).filter(Boolean);b.returnValue=q}catch(j){console.error("[snail] Error getting plugins:",j),b.returnValue=[]}});K.ipcMain.on("SNAIL_GET_THEME_FILE",(b,j)=>{let k=J.join(Z,j),q={},v=w(j);if(!v){b.returnValue=q;return}if(v.css){let z=Array.isArray(v.css)?v.css:[v.css];q.css=z.map((W)=>{let B=J.join(k,W);if(x.existsSync(B))return x.readFileSync(B,"utf8");return""}).join(`
`)}b.returnValue=q});K.ipcMain.on("SNAIL_GET_PLUGIN_FILE",(b,j)=>{let k=M(j);b.returnValue=k});K.app.once("browser-window-created",(b,j)=>{let k=j.webContents.session.getPreloads()||[];if(!k.includes(G))j.webContents.session.setPreloads([...k,G])});
